{% extends 'base.html' %}
{% block title %}
	Diary | List
{% endblock %}
{% block content %}
	<h3>Hard Wood Laminate</h3>
	<div id="interval-div">
	    <label for="interval">Interval:</label>
	    <select id="interval" onchange="get_data(this)">
	    	<option value=93>3 Months</option>
	    	<option value=186>6 Month</option>
	    	<option value=365>1 Year</option>
	    	<option value=744>2 Years</option>
	    	<option value=1116>3 Years</option>
	    </select>
	</div>
	<div id="control-div">
		<button onclick="createTable(this)">table</button>
		<button onclick="displayDiaryList(this)" id="show-table-btn">show table</button>
		<a href="{{diary_create}}" class="btn btn-success" id="create-diary-btn">create diary</a>

		<button onclick="displayDiaryList(this)">Display Table</button>
		<button onclick="hideDiaryList(this)">Hide Table</button>
	</div>
	<div id="content-div">
	</div>
	<div id="table-div">
	</div>
	<script>
		let diary_data = [];
		let filteredData = [];
		let selected_index = null;

		// get the data from the server
		const get_data = async () => {
			const res = await fetch('{{domain}}?interval='+interval.value);
			const data = await res.json();
			// set the variable
			diary_data = data;
			return data;
		}

		const update_selected_index = (e) => {
			// the index of the selected element
			selected_index = e.srcElement.parentNode.id;
			displayContent(diary_data[selected_index]);
			// hide the table
			tableDiv.style.display = "none";
			showTableBtn.style.display = "inline";
			contentDiv.style.display = "block";
		}

		const displayDiaryList = () => setElementsDisplay(diaryListComponents, 'block');
			
		const hideDiaryList = () => setElementsDisplay(diaryListComponents, 'none');

		const setElementsDisplay = (elements, display_type) => {
			console.log(elements)
			elements.forEach((element) => {element.style.display = display})
		}

		const displayContent = (content) => {
			contentDiv.innerHTML = "";
			contentDiv.innerHTML = "<p>" + content["title"] + "<br>" + content["timestamp"] + "</p>";
			contentDiv.innerHTML += content["content"];
		}

		// create a table base on fund and category
		const createTable = (e) => {
			let diaries = diary_data;
			// table to tabulate all of the expense data
			let table = document.createElement("TABLE");
			table.className = "table";
			// loop thriugh all the expense data
			// and create a row for each expense entry
			diaries.forEach((diary, i) => {
				// insert a row on table for each expense entry
				let row = table.insertRow(i);
				row.id = i;
				row.onclick = update_selected_index;
				// the properties of the expense such as desctription, price, ...etc
				let diary_properties = Object.keys(diary);
				diary_properties.forEach((diary_property, j) => {
					// the value of the expense property i.e. description="pambili ng ulam"
					let diary_property_value = diary[diary_property];
					// add the cells that contain the properties of the expenses
					let cell = row.insertCell(j);
					if(diary_property == 'content' || diary_property == 'user'){
						// do nothing if the property is the content
					}else{
						cell.innerHTML = diary_property_value;
					}
				});
			});
			// empty the div first before adding the new table
			tableDiv.innerHTML = '';
			tableDiv.appendChild(table);

			// hide the show table button
			showTableBtn.style.display = "none";
		}

		const controlDiv = document.getElementById("control-div");
		// diary list conponent
		const tableDiv = document.getElementById("table-div");
		const createDiaryBtn = document.getElementById("create-diary-btn");
		const intervalDiv = document.getElementById("interval-div");

		const diaryListComponents = [tableDiv, createDiaryBtn, intervalDiv];


		const contentDiv = document.getElementById("content-div");
		const showTableBtn = document.getElementById("show-table-btn");
	</script>
{% endblock %}